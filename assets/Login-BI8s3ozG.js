var G=Object.defineProperty;var M=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var R=(m,u,s)=>u in m?G(m,u,{enumerable:!0,configurable:!0,writable:!0,value:s}):m[u]=s,U=(m,u)=>{for(var s in u||(u={}))J.call(u,s)&&R(m,s,u[s]);if(M)for(var s of M(u))K.call(u,s)&&R(m,s,u[s]);return m};var $=(m,u,s)=>new Promise((k,c)=>{var V=d=>{try{p(s.next(d))}catch(v){c(v)}},n=d=>{try{p(s.throw(d))}catch(v){c(v)}},p=d=>d.done?k(d.value):Promise.resolve(d.value).then(V,n);p((s=s.apply(m,u)).next())});import{c as Q,e as W,l as X,f as Y,g as ee,h as ae,i as le}from"../index.js";/* empty css                   *//* empty css                *//* empty css                 *//* empty css                    *//* empty css                     */import{x as oe,r as _,j as re,y as te,P as l,H as o,aB as se,z as ne,u as C,A as I,L as g,M as w,V as ue}from"./vue-Bz1rze_z.js";import{u as de,D as ie,v as me,w as pe,o as ce,F as ge,G as fe,E as we,H as _e,I as ve,J as be,c as he,K as Ve,L as Pe,M as ye,b as h}from"./elementplus-C7q1zps1.js";const $e={class:"flex justify-center items-center min-h-screen bg-[#f5f7fa]"},ke={class:"flex justify-between items-center"},Ce={class:"ml-auto"},Ie={class:"flex w-full gap-2"},Ue=oe({name:"Login",__name:"Login",setup(m){const u=se(),s=Q(),{locale:k,t:c}=W(),V=_(),n=_({username:"",password:"",captcha:"",remember:!1}),p=_(!1),d=_("1234"),v=()=>{d.value=Math.floor(1e3+Math.random()*9e3).toString()},E=()=>{var e;(e=V.value)==null||e.validateField("captcha")};re(()=>{const e=localStorage.getItem("rememberedUser");e&&(n.value.username=e,n.value.remember=!0),v()});const S={username:[{required:!0,message:c("login.rules.username"),trigger:"blur"},{min:5,max:15,message:c("login.rules.usernameLen"),trigger:"blur"}],password:[{required:!0,message:c("login.rules.password"),trigger:"blur"},{pattern:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,18}$/,message:"密码需为6-18位，包含字母和数字",trigger:"blur"}],captcha:[{required:!0,message:c("login.rules.captcha"),trigger:"blur"},{pattern:/^\d{4}$/,message:c("login.rules.captchaLen"),trigger:"blur"},{asyncValidator:(e,a)=>a!==d.value?Promise.reject(c("login.rules.captchaAuth")):Promise.resolve(),trigger:"blur"}]},j=e=>{k.value=e,localStorage.setItem("lang",e)},z=e=>$(this,null,function*(){e&&(yield e.validate((a,y)=>$(this,null,function*(){if(a){n.value.captcha!==d.value&&E(),p.value=!0;try{const r=yield X(U({},n.value));if(!r.data.user.enabled){h.warning("该用户已被禁用"),p.value=!1;return}r.code===200?(h.success(r.message),p.value=!1,n.value.remember?localStorage.setItem("rememberedUser",n.value.username):localStorage.removeItem("rememberedUser"),s.userInfo=r.data.user,Y(r.data.accessToken),ee(r.data.refreshToken),yield ae(),u.replace("/")):(h.error(r.message),p.value=!1)}catch(r){p.value=!1,h.error("登录异常")}}else console.log("error submit!",y)})))}),P=_(!1),x=_(),i=_({oldPwd:"",newPwd:"",confirmPwd:""}),A={oldPwd:[{required:!0,message:"请输入旧密码",trigger:"blur"},{min:5,max:15,message:"密码需为6-18位，包含字母和数字",trigger:"blur"}],newPwd:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:5,max:15,message:"密码需为6-18位，包含字母和数字",trigger:"blur"},{pattern:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,18}$/,message:"新密码需为6-18位，包含字母和数字",trigger:"blur"},{asyncValidator:(e,a)=>a!==i.value.confirmPwd&&i.value.confirmPwd?Promise.reject("两次输入密码不一致"):Promise.resolve(),trigger:"blur"}],confirmPwd:[{required:!0,message:"请确认新密码",trigger:"blur"},{asyncValidator:(e,a)=>a!==i.value.newPwd?Promise.reject("两次输入密码不一致"):Promise.resolve(),trigger:"blur"}]},D=()=>{P.value=!0},q=e=>$(this,null,function*(){e&&e.validate((a,y)=>$(this,null,function*(){if(a)try{const r=yield le(U({},i.value));r.code===200?(h.success(r.message),e.resetFields(),P.value=!1):h.error(r.message)}catch(r){}else console.log("error submit!",y)}))});return(e,a)=>{const y=he,r=we,F=ye,B=Pe,T=be,b=ce,f=pe,Z=_e,N=ve,L=me,H=de,O=ie;return ne(),te("div",$e,[l(H,{class:"w-[500px] rounded-[8px] shadow-[0_2px_12px_0_rgba(0,0,0,0.1)]"},{header:o(()=>[I("div",ke,[I("h2",null,w(e.$t("login.title")),1),I("div",Ce,[l(T,{onCommand:j},{dropdown:o(()=>[l(B,null,{default:o(()=>[l(F,{command:"zh"},{default:o(()=>[g(w(e.$t("language.zh")),1)]),_:1}),l(F,{command:"en"},{default:o(()=>[g(w(e.$t("language.en")),1)]),_:1})]),_:1})]),default:o(()=>[l(r,{link:""},{default:o(()=>[g(w(e.$t(`language.${C(k)}`))+" ",1),l(y,{class:"el-icon--right"},{default:o(()=>[l(C(Ve))]),_:1})]),_:1})]),_:1})])])]),default:o(()=>[l(L,{ref_key:"loginFormRef",ref:V,model:n.value,rules:S,"label-position":"right","label-width":"auto"},{default:o(()=>[l(f,{label:e.$t("login.username"),prop:"username"},{default:o(()=>[l(b,{modelValue:n.value.username,"onUpdate:modelValue":a[0]||(a[0]=t=>n.value.username=t),placeholder:e.$t("login.rules.username"),"prefix-icon":C(ge)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1},8,["label"]),l(f,{label:e.$t("login.password"),prop:"password"},{default:o(()=>[l(b,{modelValue:n.value.password,"onUpdate:modelValue":a[1]||(a[1]=t=>n.value.password=t),type:"password",placeholder:e.$t("login.rules.password"),"prefix-icon":C(fe),"show-password":""},null,8,["modelValue","placeholder","prefix-icon"])]),_:1},8,["label"]),l(f,{label:e.$t("login.captcha"),prop:"captcha"},{default:o(()=>[I("div",Ie,[l(b,{modelValue:n.value.captcha,"onUpdate:modelValue":a[2]||(a[2]=t=>n.value.captcha=t),placeholder:e.$t("login.rules.captcha"),onBlur:E},null,8,["modelValue","placeholder"]),l(r,{onClick:v},{default:o(()=>[g(w(d.value),1)]),_:1})])]),_:1},8,["label"]),l(f,null,{default:o(()=>[l(Z,{modelValue:n.value.remember,"onUpdate:modelValue":a[3]||(a[3]=t=>n.value.remember=t)},{default:o(()=>[g(w(e.$t("login.remember")),1)]),_:1},8,["modelValue"]),l(N,{type:"primary",class:"float-right",onClick:D},{default:o(()=>[g(w(e.$t("login.forgot")),1)]),_:1})]),_:1}),l(f,null,{default:o(()=>[l(r,{type:"primary","native-type":"submit",class:"w-[100%] mt-[10px]",loading:p.value,onClick:a[4]||(a[4]=ue(t=>z(V.value),["prevent"]))},{default:o(()=>[g(w(e.$t("login.button")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),l(O,{modelValue:P.value,"onUpdate:modelValue":a[10]||(a[10]=t=>P.value=t),title:"修改密码",width:"500px"},{footer:o(()=>[l(r,{onClick:a[8]||(a[8]=t=>P.value=!1)},{default:o(()=>[g("取消")]),_:1}),l(r,{type:"primary",onClick:a[9]||(a[9]=t=>q(x.value))},{default:o(()=>[g("提交")]),_:1})]),default:o(()=>[l(L,{ref_key:"pwdRef",ref:x,model:i.value,rules:A,"label-width":"100px"},{default:o(()=>[l(f,{label:"旧密码",prop:"oldPwd"},{default:o(()=>[l(b,{modelValue:i.value.oldPwd,"onUpdate:modelValue":a[5]||(a[5]=t=>i.value.oldPwd=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(f,{label:"新密码",prop:"newPwd"},{default:o(()=>[l(b,{modelValue:i.value.newPwd,"onUpdate:modelValue":a[6]||(a[6]=t=>i.value.newPwd=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(f,{label:"确认密码",prop:"confirmPwd"},{default:o(()=>[l(b,{modelValue:i.value.confirmPwd,"onUpdate:modelValue":a[7]||(a[7]=t=>i.value.confirmPwd=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Ae=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"}));export{Ae as _};
