var g=(s,m,n)=>new Promise((p,d)=>{var _=r=>{try{f(n.next(r))}catch(c){d(c)}},l=r=>{try{f(n.throw(r))}catch(c){d(c)}},f=r=>r.done?p(r.value):Promise.resolve(r.value).then(_,l);f((n=n.apply(s,m)).next())});import{v,c as q,q as F,r as L}from"../index.js";/* empty css                   *//* empty css                 *//* empty css                  *//* empty css                  *//* empty css                     */import{u as $,v as D,o as P,x as R,t as j,C as M,E as N,y as z,b as y}from"./elementplus-D2sT-qyg.js";import{v as G,r as E,V as k,w as H,J as S,K as a,y as V,M as t,x as J,aa as K,H as A,a2 as I}from"./vue-DRv-BlT3.js";function se(s,m,n){return v(`/users?page=${s}&pageSize=${m}&username=${n}`,{method:"GET"})}function Q(s){return v("/userSave",{method:"POST",body:s})}function ae(s){return v("/userDelete",{method:"POST",body:s})}function re(s){return v("/userEnabled",{method:"POST",body:s})}const ne=G({__name:"UserForm",props:{visible:{type:Boolean},user:{}},emits:["update:visible","saved"],setup(s,{emit:m}){const n=q(),p=s,d=m,_=E(),l=k({username:"",password:"",nickname:"",enabled:!0,roleIds:[]}),f=k({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"}]}),r=E([]);H(()=>p.visible,u=>{u&&(c(),p.user?Object.assign(l,p.user):Object.assign(l,{username:"",password:"",nickname:"",enabled:!0,roleIds:[]}))},{immediate:!0});function c(){return g(this,null,function*(){const u=yield L(1,9999,"");r.value=u.data})}function U(){return g(this,null,function*(){var u;try{const e=n.userInfo.id===l.id;yield(u=_.value)==null?void 0:u.validate();const i=yield Q(l);i.code===200?(y.success(i.message),d("update:visible",!1),d("saved"),e&&F(!0)):y.error(i.message||"保存失败")}catch(e){console.log(e)}})}return(u,e)=>{const i=P,b=D,x=z,O=R,B=j,C=M,w=N,T=$;return V(),S(T,{title:l.id?"编辑用户":"新增用户","model-value":u.visible,width:"500px","destroy-on-close":"","onUpdate:modelValue":e[6]||(e[6]=o=>d("update:visible",o))},{footer:a(()=>[t(w,{onClick:e[5]||(e[5]=o=>d("update:visible",!1))},{default:a(()=>e[7]||(e[7]=[I("取消")])),_:1,__:[7]}),t(w,{type:"primary",onClick:U},{default:a(()=>e[8]||(e[8]=[I("保存")])),_:1,__:[8]})]),default:a(()=>[t(C,{ref_key:"formRef",ref:_,model:l,rules:f,"label-width":"100px"},{default:a(()=>[t(b,{label:"用户名",prop:"username"},{default:a(()=>[t(i,{modelValue:l.username,"onUpdate:modelValue":e[0]||(e[0]=o=>l.username=o),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),t(b,{label:"密码",prop:"password"},{default:a(()=>[t(i,{modelValue:l.password,"onUpdate:modelValue":e[1]||(e[1]=o=>l.password=o),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(b,{label:"昵称",prop:"nickname"},{default:a(()=>[t(i,{modelValue:l.nickname,"onUpdate:modelValue":e[2]||(e[2]=o=>l.nickname=o),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),t(b,{label:"分配角色",prop:"roleIds"},{default:a(()=>[t(O,{modelValue:l.roleIds,"onUpdate:modelValue":e[3]||(e[3]=o=>l.roleIds=o),multiple:"",filterable:"",placeholder:"请选择角色"},{default:a(()=>[(V(!0),J(A,null,K(r.value,o=>(V(),S(x,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(b,{label:"是否启用",prop:"enabled"},{default:a(()=>[t(B,{modelValue:l.enabled,"onUpdate:modelValue":e[4]||(e[4]=o=>l.enabled=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","model-value"])}}});export{ne as _,ae as a,re as b,se as u};
