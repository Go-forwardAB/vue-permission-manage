var Q=Object.defineProperty,W=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var P=(o,t,e)=>t in o?Q(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,I=(o,t)=>{for(var e in t||(t={}))X.call(t,e)&&P(o,e,t[e]);if(T)for(var e of T(t))Y.call(t,e)&&P(o,e,t[e]);return o},g=(o,t)=>W(o,J(t));var M=(o,t,e)=>new Promise((n,h)=>{var r=s=>{try{c(e.next(s))}catch(_){h(_)}},y=s=>{try{c(e.throw(s))}catch(_){h(_)}},c=s=>s.done?n(s.value):Promise.resolve(s.value).then(r,y);c((e=e.apply(o,t)).next())});import{c as Z,u as $,o as ee,p as te,q as oe,k as le}from"../index.js";/* empty css                   *//* empty css                    */import{b as w,P as ae,j as ne,i as se,E as ue,D as re,L as ce,Q as de}from"./elementplus-zf-Affb6.js";import{x as ie,r as v,h as U,c as O,k as me,y as k,G as j,H as u,P as p,L as x,z as E,a4 as D,O as L,A as pe,M as N}from"./vue-D-ZuiWlZ.js";function z(o,t=0){return o.filter(e=>e.parentId===t&&e.type!=="button").map(e=>g(I({},e),{children:z(o,e.id)}))}function _e(o){return o.filter(t=>t.type==="menu"&&t.visible!==!1).map(t=>{const e=o.filter(n=>n.type==="button"&&n.parentId===t.id);return g(I({},t),{buttons:e})})}const fe={class:"menu-title"},be=ie({__name:"Permission",props:{modelValue:{type:Boolean},roleId:{}},emits:["update:modelValue","saved"],setup(o,{emit:t}){const e=Z(),n=o,h=t,r=v(n.modelValue),y=v("menu");U(()=>n.modelValue,i=>r.value=i),U(()=>r.value,i=>h("update:modelValue",i));const c=$(),s=O(()=>z(c.init_menus,0)),_=O(()=>_e(c.init_menus)),B=v([]),V=v([]),C=v(),A={label:"title",children:"children"};function F(){return M(this,null,function*(){const a=(yield ee(n.roleId)).data||[];B.value=a.filter(d=>c.init_menus.some(l=>l.id===d&&l.type!=="button")),V.value=a.filter(d=>c.init_menus.some(l=>l.id===d&&l.type==="button"))})}function G(){return M(this,null,function*(){var d;const i=((d=C.value)==null?void 0:d.getCheckedKeys())||[],a=Array.from(new Set([...i,...V.value]));try{const l=e.userInfo.roleIds.indexOf(n.roleId)!==-1,f=yield te({roleId:n.roleId,menuIds:a});f.code===200?(w.success(f.message),r.value=!1,l&&oe(!0)):w.error(f.error)}catch(l){console.error(l)}})}function R(){r.value=!1}return me(F),(i,a)=>{const d=ae,l=ne,f=ce,q=de,H=se,S=ue,K=re;return k(),j(K,{modelValue:r.value,"onUpdate:modelValue":a[2]||(a[2]=m=>r.value=m),title:"分配权限",width:"600px","close-on-click-modal":!1},{footer:u(()=>[p(S,{onClick:R},{default:u(()=>[x("取消")]),_:1}),p(S,{type:"primary",onClick:G},{default:u(()=>[x("保存")]),_:1})]),default:u(()=>[p(H,{modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=m=>y.value=m)},{default:u(()=>[p(l,{label:"菜单权限",name:"menu"},{default:u(()=>[p(d,{ref_key:"treeRef",ref:C,data:s.value,"show-checkbox":"","node-key":"id","highlight-current":"","default-checked-keys":B.value,props:A,class:"permission-tree"},null,8,["data","default-checked-keys"])]),_:1}),p(l,{label:"按钮权限",name:"button"},{default:u(()=>[(k(!0),E(L,null,D(_.value,m=>(k(),E("div",{key:m.id,class:"menu-button-group"},[pe("div",fe,N(m.title),1),p(q,{modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=b=>V.value=b)},{default:u(()=>[(k(!0),E(L,null,D(m.buttons,b=>(k(),j(f,{key:b.id,value:b.id},{default:u(()=>[x(N(b.title),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])]))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),ve=le(be,[["__scopeId","data-v-ebb67df1"]]),Me=Object.freeze(Object.defineProperty({__proto__:null,default:ve},Symbol.toStringTag,{value:"Module"}));export{ve as P,Me as _};
