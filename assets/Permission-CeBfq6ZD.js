var L=Object.defineProperty,W=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var w=(o,t,e)=>t in o?L(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,I=(o,t)=>{for(var e in t||(t={}))X.call(t,e)&&w(o,e,t[e]);if(T)for(var e of T(t))Y.call(t,e)&&w(o,e,t[e]);return o},g=(o,t)=>W(o,Q(t));var M=(o,t,e)=>new Promise((n,y)=>{var r=s=>{try{d(e.next(s))}catch(_){y(_)}},h=s=>{try{d(e.throw(s))}catch(_){y(_)}},d=s=>s.done?n(s.value):Promise.resolve(s.value).then(r,h);d((e=e.apply(o,t)).next())});import{c as Z,u as $,o as ee,p as te,q as oe,k as le}from"../index.js";/* empty css                   *//* empty css                    */import{u as ae,j as ne,O as se,i as ue,E as re,P as de,G as ce,b as P}from"./elementplus-D2sT-qyg.js";import{v as ie,r as b,w as U,c as j,j as me,J as O,K as u,y as k,M as p,x,aa as N,H as D,a2 as B,B as pe,P as F}from"./vue-DRv-BlT3.js";function G(o,t=0){return o.filter(e=>e.parentId===t&&e.type!=="button").map(e=>g(I({},e),{children:G(o,e.id)}))}function _e(o){return o.filter(t=>t.type==="menu"&&t.visible!==!1).map(t=>{const e=o.filter(n=>n.type==="button"&&n.parentId===t.id);return g(I({},t),{buttons:e})})}const fe={class:"menu-title"},ve=ie({__name:"Permission",props:{modelValue:{type:Boolean},roleId:{}},emits:["update:modelValue","saved"],setup(o,{emit:t}){const e=Z(),n=o,y=t,r=b(n.modelValue),h=b("menu");U(()=>n.modelValue,i=>r.value=i),U(()=>r.value,i=>y("update:modelValue",i));const d=$(),s=j(()=>G(d.init_menus,0)),_=j(()=>_e(d.init_menus)),E=b([]),V=b([]),C=b(),K={label:"title",children:"children"};function R(){return M(this,null,function*(){const l=(yield ee(n.roleId)).data||[];E.value=l.filter(c=>d.init_menus.some(a=>a.id===c&&a.type!=="button")),V.value=l.filter(c=>d.init_menus.some(a=>a.id===c&&a.type==="button"))})}function q(){return M(this,null,function*(){var c;const i=((c=C.value)==null?void 0:c.getCheckedKeys())||[],l=Array.from(new Set([...i,...V.value]));try{const a=e.userInfo.roleIds.indexOf(n.roleId)!==-1,f=yield te({roleId:n.roleId,menuIds:l});f.code===200?(P.success(f.message),r.value=!1,a&&oe(!0)):P.error(f.error)}catch(a){console.error(a)}})}function z(){r.value=!1}return me(R),(i,l)=>{const c=se,a=ne,f=ce,A=de,H=ue,S=re,J=ae;return k(),O(J,{modelValue:r.value,"onUpdate:modelValue":l[2]||(l[2]=m=>r.value=m),title:"分配权限",width:"600px","close-on-click-modal":!1},{footer:u(()=>[p(S,{onClick:z},{default:u(()=>l[3]||(l[3]=[B("取消")])),_:1,__:[3]}),p(S,{type:"primary",onClick:q},{default:u(()=>l[4]||(l[4]=[B("保存")])),_:1,__:[4]})]),default:u(()=>[p(H,{modelValue:h.value,"onUpdate:modelValue":l[1]||(l[1]=m=>h.value=m)},{default:u(()=>[p(a,{label:"菜单权限",name:"menu"},{default:u(()=>[p(c,{ref_key:"treeRef",ref:C,data:s.value,"show-checkbox":"","node-key":"id","highlight-current":"","default-checked-keys":E.value,props:K,class:"permission-tree"},null,8,["data","default-checked-keys"])]),_:1}),p(a,{label:"按钮权限",name:"button"},{default:u(()=>[(k(!0),x(D,null,N(_.value,m=>(k(),x("div",{key:m.id,class:"menu-button-group"},[pe("div",fe,F(m.title),1),p(A,{modelValue:V.value,"onUpdate:modelValue":l[0]||(l[0]=v=>V.value=v)},{default:u(()=>[(k(!0),x(D,null,N(m.buttons,v=>(k(),O(f,{key:v.id,value:v.id},{default:u(()=>[B(F(v.title),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])]))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),be=le(ve,[["__scopeId","data-v-ebb67df1"]]),Me=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"}));export{be as P,Me as _};
