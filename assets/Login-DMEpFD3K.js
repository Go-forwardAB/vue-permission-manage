var G=Object.defineProperty;var S=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var j=(m,u,s)=>u in m?G(m,u,{enumerable:!0,configurable:!0,writable:!0,value:s}):m[u]=s,U=(m,u)=>{for(var s in u||(u={}))H.call(u,s)&&j(m,s,u[s]);if(S)for(var s of S(u))J.call(u,s)&&j(m,s,u[s]);return m};var $=(m,u,s)=>new Promise((k,g)=>{var P=d=>{try{p(s.next(d))}catch(_){g(_)}},n=d=>{try{p(s.throw(d))}catch(_){g(_)}},p=d=>d.done?k(d.value):Promise.resolve(d.value).then(P,n);p((s=s.apply(m,u)).next())});import{c as Q,e as W,l as X,f as Y,g as ee,h as le,i as ae}from"../index.js";/* empty css                   *//* empty css                *//* empty css                 *//* empty css                    *//* empty css                     */import{v as oe,r as v,j as re,x as te,M as a,K as o,av as se,y as ne,u as C,B as I,a2 as c,P as w,O as ue}from"./vue-DRv-BlT3.js";import{n as de,u as ie,C as me,v as pe,o as ge,D as ce,F as fe,E as we,G as ve,H as _e,I as be,c as he,J as Pe,K as Ve,L as ye,b as h}from"./elementplus-D2sT-qyg.js";const $e={class:"flex justify-center items-center min-h-screen bg-[#f5f7fa]"},ke={class:"flex justify-between items-center"},Ce={class:"ml-auto"},Ie={class:"flex w-full gap-2"},Ue=oe({name:"Login",__name:"Login",setup(m){const u=se(),s=Q(),{locale:k,t:g}=W(),P=v(),n=v({username:"",password:"",captcha:"",remember:!1}),p=v(!1),d=v("1234"),_=()=>{d.value=Math.floor(1e3+Math.random()*9e3).toString()},E=()=>{var l;(l=P.value)==null||l.validateField("captcha")};re(()=>{const l=localStorage.getItem("rememberedUser");l&&(n.value.username=l,n.value.remember=!0),_()});const L={username:[{required:!0,message:g("login.rules.username"),trigger:"blur"},{min:5,max:15,message:g("login.rules.usernameLen"),trigger:"blur"}],password:[{required:!0,message:g("login.rules.password"),trigger:"blur"},{pattern:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,18}$/,message:"密码需为6-18位，包含字母和数字",trigger:"blur"}],captcha:[{required:!0,message:g("login.rules.captcha"),trigger:"blur"},{pattern:/^\d{4}$/,message:g("login.rules.captchaLen"),trigger:"blur"},{asyncValidator:(l,e)=>e!==d.value?Promise.reject(g("login.rules.captchaAuth")):Promise.resolve(),trigger:"blur"}]},M=l=>{k.value=l,localStorage.setItem("lang",l)},z=l=>$(this,null,function*(){l&&(yield l.validate((e,y)=>$(this,null,function*(){if(e){n.value.captcha!==d.value&&E(),p.value=!0;try{const r=yield X(U({},n.value));if(!r.data.user.enabled){h.warning("该用户已被禁用"),p.value=!1;return}r.code===200?(h.success(r.message),p.value=!1,n.value.remember?localStorage.setItem("rememberedUser",n.value.username):localStorage.removeItem("rememberedUser"),s.userInfo=r.data.user,Y(r.data.accessToken),ee(r.data.refreshToken),yield le(),u.replace("/")):(h.error(r.message),p.value=!1)}catch(r){p.value=!1,h.error("登录异常")}}else console.log("error submit!",y)})))}),V=v(!1),x=v(),i=v({oldPwd:"",newPwd:"",confirmPwd:""}),D={oldPwd:[{required:!0,message:"请输入旧密码",trigger:"blur"},{min:5,max:15,message:"密码需为6-18位，包含字母和数字",trigger:"blur"}],newPwd:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:5,max:15,message:"密码需为6-18位，包含字母和数字",trigger:"blur"},{pattern:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,18}$/,message:"新密码需为6-18位，包含字母和数字",trigger:"blur"},{asyncValidator:(l,e)=>e!==i.value.confirmPwd&&i.value.confirmPwd?Promise.reject("两次输入密码不一致"):Promise.resolve(),trigger:"blur"}],confirmPwd:[{required:!0,message:"请确认新密码",trigger:"blur"},{asyncValidator:(l,e)=>e!==i.value.newPwd?Promise.reject("两次输入密码不一致"):Promise.resolve(),trigger:"blur"}]},q=()=>{V.value=!0},A=l=>$(this,null,function*(){l&&l.validate((e,y)=>$(this,null,function*(){if(e)try{const r=yield ae(U({},i.value));r.code===200?(h.success(r.message),l.resetFields(),V.value=!1):h.error(r.message)}catch(r){}else console.log("error submit!",y)}))});return(l,e)=>{const y=he,r=we,F=ye,B=Ve,T=be,b=ge,f=pe,Z=ve,N=_e,R=me,O=de,K=ie;return ne(),te("div",$e,[a(O,{class:"w-[500px] rounded-[8px] shadow-[0_2px_12px_0_rgba(0,0,0,0.1)]"},{header:o(()=>[I("div",ke,[I("h2",null,w(l.$t("login.title")),1),I("div",Ce,[a(T,{onCommand:M},{dropdown:o(()=>[a(B,null,{default:o(()=>[a(F,{command:"zh"},{default:o(()=>[c(w(l.$t("language.zh")),1)]),_:1}),a(F,{command:"en"},{default:o(()=>[c(w(l.$t("language.en")),1)]),_:1})]),_:1})]),default:o(()=>[a(r,{link:""},{default:o(()=>[c(w(l.$t(`language.${C(k)}`))+" ",1),a(y,{class:"el-icon--right"},{default:o(()=>[a(C(Pe))]),_:1})]),_:1})]),_:1})])])]),default:o(()=>[a(R,{ref_key:"loginFormRef",ref:P,model:n.value,rules:L,"label-position":"right","label-width":"auto"},{default:o(()=>[a(f,{label:l.$t("login.username"),prop:"username"},{default:o(()=>[a(b,{modelValue:n.value.username,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value.username=t),placeholder:l.$t("login.rules.username"),"prefix-icon":C(ce)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1},8,["label"]),a(f,{label:l.$t("login.password"),prop:"password"},{default:o(()=>[a(b,{modelValue:n.value.password,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.password=t),type:"password",placeholder:l.$t("login.rules.password"),"prefix-icon":C(fe),"show-password":""},null,8,["modelValue","placeholder","prefix-icon"])]),_:1},8,["label"]),a(f,{label:l.$t("login.captcha"),prop:"captcha"},{default:o(()=>[I("div",Ie,[a(b,{modelValue:n.value.captcha,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.captcha=t),placeholder:l.$t("login.rules.captcha"),onBlur:E},null,8,["modelValue","placeholder"]),a(r,{onClick:_},{default:o(()=>[c(w(d.value),1)]),_:1})])]),_:1},8,["label"]),a(f,null,{default:o(()=>[a(Z,{modelValue:n.value.remember,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.remember=t)},{default:o(()=>[c(w(l.$t("login.remember")),1)]),_:1},8,["modelValue"]),a(N,{type:"primary",class:"float-right",onClick:q},{default:o(()=>[c(w(l.$t("login.forgot")),1)]),_:1})]),_:1}),a(f,null,{default:o(()=>[a(r,{type:"primary","native-type":"submit",class:"w-[100%] mt-[10px]",loading:p.value,onClick:e[4]||(e[4]=ue(t=>z(P.value),["prevent"]))},{default:o(()=>[c(w(l.$t("login.button")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),a(K,{modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=t=>V.value=t),title:"修改密码",width:"500px"},{footer:o(()=>[a(r,{onClick:e[8]||(e[8]=t=>V.value=!1)},{default:o(()=>e[11]||(e[11]=[c("取消")])),_:1,__:[11]}),a(r,{type:"primary",onClick:e[9]||(e[9]=t=>A(x.value))},{default:o(()=>e[12]||(e[12]=[c("提交")])),_:1,__:[12]})]),default:o(()=>[a(R,{ref_key:"pwdRef",ref:x,model:i.value,rules:D,"label-width":"100px"},{default:o(()=>[a(f,{label:"旧密码",prop:"oldPwd"},{default:o(()=>[a(b,{modelValue:i.value.oldPwd,"onUpdate:modelValue":e[5]||(e[5]=t=>i.value.oldPwd=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(f,{label:"新密码",prop:"newPwd"},{default:o(()=>[a(b,{modelValue:i.value.newPwd,"onUpdate:modelValue":e[6]||(e[6]=t=>i.value.newPwd=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(f,{label:"确认密码",prop:"confirmPwd"},{default:o(()=>[a(b,{modelValue:i.value.confirmPwd,"onUpdate:modelValue":e[7]||(e[7]=t=>i.value.confirmPwd=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),De=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"}));export{De as _};
