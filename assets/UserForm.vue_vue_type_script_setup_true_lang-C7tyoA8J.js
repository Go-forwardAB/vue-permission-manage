var g=(s,m,n)=>new Promise((p,d)=>{var _=r=>{try{c(n.next(r))}catch(f){d(f)}},e=r=>{try{c(n.throw(r))}catch(f){d(f)}},c=r=>r.done?p(r.value):Promise.resolve(r.value).then(_,e);c((n=n.apply(s,m)).next())});import{v,c as q,q as C,r as D}from"../index.js";/* empty css                   *//* empty css                 *//* empty css                  *//* empty css                  *//* empty css                     */import{D as F,v as P,w as $,o as z,y as R,z as h,t as j,E as G,b as y}from"./elementplus-C7q1zps1.js";import{x as N,r as E,X as k,w as H,G as S,z as V,H as a,P as t,y as M,O as X,a6 as A,L as I}from"./vue-Bz1rze_z.js";function se(s,m,n){return v(`/users?page=${s}&pageSize=${m}&username=${n}`,{method:"GET"})}function J(s){return v("/userSave",{method:"POST",body:s})}function ae(s){return v("/userDelete",{method:"POST",body:s})}function re(s){return v("/userEnabled",{method:"POST",body:s})}const ne=N({__name:"UserForm",props:{visible:{type:Boolean},user:{}},emits:["update:visible","saved"],setup(s,{emit:m}){const n=q(),p=s,d=m,_=E(),e=k({username:"",password:"",nickname:"",enabled:!0,roleIds:[]}),c=k({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"}]}),r=E([]);H(()=>p.visible,u=>{u&&(f(),p.user?Object.assign(e,p.user):Object.assign(e,{username:"",password:"",nickname:"",enabled:!0,roleIds:[]}))},{immediate:!0});function f(){return g(this,null,function*(){const u=yield D(1,9999,"");r.value=u.data})}function U(){return g(this,null,function*(){var u;try{const l=n.userInfo.id===e.id;yield(u=_.value)==null?void 0:u.validate();const i=yield J(e);i.code===200?(y.success(i.message),d("update:visible",!1),d("saved"),l&&C(!0)):y.error(i.message||"保存失败")}catch(l){console.log(l)}})}return(u,l)=>{const i=z,b=$,O=h,x=R,B=j,L=P,w=G,T=F;return V(),S(T,{title:e.id?"编辑用户":"新增用户","model-value":u.visible,width:"500px","destroy-on-close":"","onUpdate:modelValue":l[6]||(l[6]=o=>d("update:visible",o))},{footer:a(()=>[t(w,{onClick:l[5]||(l[5]=o=>d("update:visible",!1))},{default:a(()=>[I("取消")]),_:1}),t(w,{type:"primary",onClick:U},{default:a(()=>[I("保存")]),_:1})]),default:a(()=>[t(L,{ref_key:"formRef",ref:_,model:e,rules:c,"label-width":"100px"},{default:a(()=>[t(b,{label:"用户名",prop:"username"},{default:a(()=>[t(i,{modelValue:e.username,"onUpdate:modelValue":l[0]||(l[0]=o=>e.username=o),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),t(b,{label:"密码",prop:"password"},{default:a(()=>[t(i,{modelValue:e.password,"onUpdate:modelValue":l[1]||(l[1]=o=>e.password=o),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(b,{label:"昵称",prop:"nickname"},{default:a(()=>[t(i,{modelValue:e.nickname,"onUpdate:modelValue":l[2]||(l[2]=o=>e.nickname=o),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),t(b,{label:"分配角色",prop:"roleIds"},{default:a(()=>[t(x,{modelValue:e.roleIds,"onUpdate:modelValue":l[3]||(l[3]=o=>e.roleIds=o),multiple:"",filterable:"",placeholder:"请选择角色"},{default:a(()=>[(V(!0),M(X,null,A(r.value,o=>(V(),S(O,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(b,{label:"是否启用",prop:"enabled"},{default:a(()=>[t(B,{modelValue:e.enabled,"onUpdate:modelValue":l[4]||(l[4]=o=>e.enabled=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","model-value"])}}});export{ne as _,ae as a,re as b,se as u};
